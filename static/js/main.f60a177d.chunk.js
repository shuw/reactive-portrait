(this["webpackJsonpreactive-portrait"]=this["webpackJsonpreactive-portrait"]||[]).push([[0],{12:function(t,e,i){},13:function(t,e,i){},14:function(t,e,i){"use strict";i.r(e);var n=i(0),o=i.n(n),a=i(6),s=i.n(a),r=(i(12),i(1)),l=i(2),d=i(4),h=i(3),p=function(){function t(){Object(r.a)(this,t)}return Object(l.a)(t,null,[{key:"get",value:function(t){var e,i;return t.lookAround?(e=1,i=1):(e=.02,i=5),{idle:{transitions:{tick50:{minTimeElapsedInState:10,wave:{probability:.001},smile:{probability:5e-4},lookingAround:{probability:3e-4},lookingAround2:{probability:2e-4}},attention:{wave:{probability:.2},thumbsUp:{probability:.3},smile:{probability:.3},thinking:{probability:.2}},thumbsUp:{thumbsUp:{}},bye:{bye:{}},lookLeft:{lookingLeft:{}},lookRight:{lookingRight:{}},lookDown:{lookingDown:{}},lookUp:{lookingUp:{}},mouseUp:{minTimeElapsedInState:i,lookingUp:{probability:e}},mouseUpLeft:{minTimeElapsedInState:i,lookingUpLeft:{probability:e}},mouseUpRight:{minTimeElapsedInState:i,lookingUpRight:{probability:e}},mouseLeft:{minTimeElapsedInState:i,lookingLeft:{probability:e}},mouseRight:{minTimeElapsedInState:i,lookingRight:{probability:e}},mouseDown:{minTimeElapsedInState:i,lookingDown:{probability:.5*e}},mouseDownLeft:{minTimeElapsedInState:i,lookingDownLeft:{probability:e}},mouseDownRight:{minTimeElapsedInState:i,lookingDownRight:{probability:e}}}},bye:{transitions:{almostFinished:{wave:{}}}},smile:{transitions:{almostFinished:{idle:{}}}},wave:{transitions:{almostFinished:{idle:{}}}},thumbsUp:{transitions:{almostFinished:{idle:{}}}},knockKnock:{transitions:{almostFinished:{idle:{}}}},thinking:{transitions:{almostFinished:{idle:{}}}},lookingAround:{transitions:{almostFinished:{idle:{}}}},lookingAround2:{transitions:{almostFinished:{idle:{}}}},lookingUp:{transitions:{almostFinished:{idle:{}}}},lookingUpLeft:{transitions:{almostFinished:{idle:{}}}},lookingUpRight:{transitions:{almostFinished:{idle:{}}}},lookingLeft:{transitions:{almostFinished:{idle:{}}}},lookingRight:{transitions:{almostFinished:{idle:{}}}},lookingDown:{transitions:{almostFinished:{idle:{}}}},lookingDownLeft:{transitions:{almostFinished:{idle:{}}}},lookingDownRight:{transitions:{almostFinished:{idle:{}}}}}}}]),t}(),u=function(){function t(e){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};Object(r.a)(this,t),this.states=p.get(i),this._setState(e)}return Object(l.a)(t,[{key:"getState",value:function(){return this._state}},{key:"getNewState",value:function(t){return this._updateState(t),this._state}},{key:"_updateState",value:function(t){var e=this.states[this._state.name];if("failed"===t)return this._setState("idle"),void(this._stateStartTime=0);var i=e.transitions[t];if(i){if(i.minTimeElapsedInState)if((new Date).getTime()-this._stateStartTime<1e3*i.minTimeElapsedInState)return;for(var n=Math.random(),o=0,a=0,s=Object.entries(i);a<s.length;a++){var r=s[a],l=r[0];if(l in this.states&&!((o+=r[1].probability||1)<n))return void this._setState(l)}}}},{key:"_setState",value:function(t){this._state={name:t,info:this.states[t]},this._stateStartTime=(new Date).getTime()}}]),t}(),c=function(t){Object(d.a)(i,t);var e=Object(h.a)(i);function i(t){var n;return Object(r.a)(this,i),(n=e.call(this,t)).onVideoLoaded=function(t){n.videoRef.current.currentTime=n.getVideoStartTime(),n.props.onVideoLoaded&&n.props.onVideoLoaded(t)},n.onVideoError=function(t){n.hasError=!0},n.hasError=!1,n.videoRef=o.a.createRef(),n}return Object(l.a)(i,[{key:"isVideoReady",value:function(){return this.videoRef.current&&4===this.videoRef.current.readyState}},{key:"playFromBeginning",value:function(){this.isVideoReady()&&(this.videoRef.current.currentTime=this.getVideoStartTime())}},{key:"isAlmostFinished",value:function(){return!!this.isVideoReady()&&this.videoRef.current.duration-this.videoRef.current.currentTime<.1}},{key:"hasFailedToLoad",value:function(){return this.hasError}},{key:"getVideoStartTime",value:function(){var t;return"idle"===this.props.name&&(null===(t=this.videoRef.current)||void 0===t?void 0:t.duration)?Math.random()*this.videoRef.current.duration:0}},{key:"render",value:function(){return o.a.createElement("div",{style:{position:"absolute",top:0,left:0,width:this.props.width,height:this.props.height,borderRadius:this.props.width/2,WebkitMaskImage:"-webkit-radial-gradient(circle, white 100%, black 100%)"}},o.a.createElement("video",{ref:this.videoRef,autoPlay:!0,muted:!0,loop:!0,playsInline:!0,onError:this.onVideoError,onLoadedData:this.onVideoLoaded,width:this.props.width,height:this.props.height,style:{opacity:this.props.opacity}},o.a.createElement("source",{src:this.props.mediaPath+"/"+this.props.name+".mov"})))}}]),i}(o.a.Component),m=function(t){Object(d.a)(i,t);var e=Object(h.a)(i);function i(t){var n;return Object(r.a)(this,i),(n=e.call(this,t)).updateTransition=function(){if(!(n.state.transitionFraction>=1)&&n.snippetRef.current&&n.snippetRef.current.isVideoReady()){n.transitionStartTime||(n.transitionStartTime=(new Date).getTime(),"idle"===n.props.name&&"idle"===n.props.newName||n.snippetRef.current.playFromBeginning());var t=(new Date).getTime()-n.transitionStartTime,e=Math.min(t/400,1);n.setState({transitionFraction:e})}},n.onVideoLoaded=function(){n.props.onVideoLoaded()},n.transitionStartTime=null,n.state={transitionFraction:1},n.snippetRef=o.a.createRef(),n}return Object(l.a)(i,[{key:"isAlmostFinished",value:function(){var t,e;return null!==(t=null===(e=this.snippetRef.current)||void 0===e?void 0:e.isAlmostFinished())&&void 0!==t&&t}},{key:"hasFailedToLoad",value:function(){var t,e;return null!==(t=null===(e=this.snippetRef.current)||void 0===e?void 0:e.hasFailedToLoad())&&void 0!==t&&t}},{key:"shouldComponentUpdate",value:function(t,e){return t.newName===this.props.newName||(e.transitionFraction=0,this.transitionStartTime=null),!0}},{key:"componentDidMount",value:function(){this._timer=window.setInterval(this.updateTransition,30)}},{key:"componentWillUnmount",value:function(){window.clearInterval(this._timer)}},{key:"render",value:function(){return this.props.newName&&this.props.newName!==this.props.name?o.a.createElement("div",null,o.a.createElement(c,{key:this.props.name,mediaPath:this.props.mediaPath,width:this.props.width,height:this.props.height,name:this.props.name,opacity:1}),o.a.createElement(c,{ref:this.snippetRef,key:this.props.newName,mediaPath:this.props.mediaPath,opacity:this.state.transitionFraction,width:this.props.width,height:this.props.height,name:this.props.newName,onVideoLoaded:this.onVideoLoaded})):o.a.createElement("div",null,o.a.createElement(c,{ref:this.snippetRef,key:this.props.name,mediaPath:this.props.mediaPath,width:this.props.width,height:this.props.height,name:this.props.name,onVideoLoaded:this.onVideoLoaded,opacity:1}))}}]),i}(o.a.Component),v=function(t){Object(d.a)(i,t);var e=Object(h.a)(i);function i(t){var n,a;return Object(r.a)(this,i),(a=e.call(this,t)).tick50Ms=function(){var t,e;a.invokeEvent("tick50Ms"),(null===(t=a.snippetRef.current)||void 0===t?void 0:t.hasFailedToLoad())&&a.invokeEvent("failed"),(null===(e=a.snippetRef.current)||void 0===e?void 0:e.isAlmostFinished())&&a.invokeEvent("almostFinished")},a.onMouseMove=function(t){if(a.rootRef.current){var e=(new Date).getTime();if(!(e-a.lastMouseEvent<50)){a.lastMouseEvent=e;var i,n,o,s=a.rootRef.current.getBoundingClientRect(),r=s.x+Math.round(s.width/2),l=s.y+Math.round(s.height/2),d=t.clientX-r,h=t.clientY-l;if(!(Math.sqrt(Math.pow(d,2)+Math.pow(h,2))<.75*s.width))d>0?(i=Math.atan(-1*h/d)*(180/Math.PI),n="Right"):(i=Math.atan(h/d)*(180/Math.PI),n="Left"),o=i>67.5?"Up":i>22.5?"Up"+n:i>-22.5?n:i>-67.5?"Down"+n:"Down",a.invokeEvent("mouse"+o)}}},a.onAttention=function(){a.invokeEvent("attention")},a.onVideoLoaded=function(){a.onLoadedCalled||(a.onLoadedCalled=!0),a.props.onLoaded&&a.props.onLoaded()},a.stateMachine=new u(i.defaultSnippet,null!==(n=t.stateMachineOptions)&&void 0!==n?n:{}),a.rootRef=o.a.createRef(),a.lastMouseEvent=(new Date).getTime(),a.snippetRef=o.a.createRef(),a.onLoadedCalled=!1,a.state={stateMachine:a.stateMachine,oldState:a.stateMachine.getState(),newState:a.stateMachine.getState()},a}return Object(l.a)(i,[{key:"componentDidMount",value:function(){this._timer=window.setInterval(this.tick50Ms,100),window.addEventListener("mousemove",this.onMouseMove)}},{key:"componentWillUnmount",value:function(){window.clearInterval(this._timer)}},{key:"invokeEvent",value:function(t){var e=this.stateMachine.getNewState(t);if(e.name!==this.state.newState.name){this.props.onSnippetChanged&&this.props.onSnippetChanged(e.name);var i="failed"===t?e:this.state.newState;this.setState({oldState:i,newState:e})}}},{key:"render",value:function(){return o.a.createElement("div",{ref:this.rootRef,onMouseEnter:this.onAttention,onClick:this.onAttention,style:{position:"relative",width:this.props.width,height:this.props.height}},o.a.createElement(m,{ref:this.snippetRef,mediaPath:this.props.snippetsMediaPath,width:this.props.width,height:this.props.height,name:this.state.oldState.name,newName:this.state.newState.name,onVideoLoaded:this.onVideoLoaded}))}}]),i}(o.a.Component);v.defaultSnippet="idle";i(13);var f=function(t){Object(d.a)(i,t);var e=Object(h.a)(i);function i(t){var n;return Object(r.a)(this,i),(n=e.call(this,t)).onPortraitChanged=function(t){n.setState({snippetName:t})},n.state={snippetName:v.defaultSnippet},n}return Object(l.a)(i,[{key:"render",value:function(){var t,e,i=this,n=new URL(document.location).searchParams,a=(null!==(t=null!==(e=n.get("names"))&&void 0!==e?e:n.get("name"))&&void 0!==t?t:"shuw").split(","),s={lookAround:null!==n.get("lookAround")},r=a.map((function(t){return o.a.createElement("li",{key:t,style:{display:"inline-block",padding:"20px"}},o.a.createElement(v,{stateMachineOptions:s,snippetsMediaPath:"/reactive-portrait/media/"+t,onSnippetChanged:i.onPortraitChanged,width:400,height:400}))})),l=null!==n.get("hideStateInfo")||1!==r.length;return o.a.createElement("div",{className:"App"},o.a.createElement("header",{className:"App-header"},o.a.createElement("ul",null,r),l?null:o.a.createElement("div",{style:{paddingTop:"20px"}},this.state.snippetName)))}}]),i}(o.a.Component);Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));s.a.render(o.a.createElement(o.a.StrictMode,null,o.a.createElement(f,null)),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(t){t.unregister()})).catch((function(t){console.error(t.message)}))},7:function(t,e,i){t.exports=i(14)}},[[7,1,2]]]);
//# sourceMappingURL=main.f60a177d.chunk.js.map
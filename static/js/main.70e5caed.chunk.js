(this["webpackJsonpreactive-portrait"]=this["webpackJsonpreactive-portrait"]||[]).push([[0],{12:function(t,e,i){},13:function(t,e,i){},14:function(t,e,i){"use strict";i.r(e);var n=i(0),o=i.n(n),a=i(6),s=i.n(a),r=(i(12),i(1)),d=i(2),l=i(4),h=i(3);if(null!==new URL(document.location).searchParams.get("lookAround"))var p=1,u=1;else p=.02,u=5;var c={idle:{transitions:{tick50:{minTimeElapsedInState:10,wave:{probability:.001},smile:{probability:5e-4},lookingAround:{probability:3e-4},lookingAround2:{probability:2e-4}},attention:{wave:{probability:.2},thumbsUp:{probability:.3},smile:{probability:.3},thinking:{probability:.2}},thumbsUp:{thumbsUp:{}},bye:{bye:{}},lookLeft:{lookingLeft:{}},lookRight:{lookingRight:{}},lookDown:{lookingDown:{}},lookUp:{lookingUp:{}},mouseUp:{minTimeElapsedInState:u,lookingUp:{probability:p}},mouseUpLeft:{minTimeElapsedInState:u,lookingUpLeft:{probability:p}},mouseUpRight:{minTimeElapsedInState:u,lookingUpRight:{probability:p}},mouseLeft:{minTimeElapsedInState:u,lookingLeft:{probability:p}},mouseRight:{minTimeElapsedInState:u,lookingRight:{probability:p}},mouseDown:{minTimeElapsedInState:u,lookingDown:{probability:.5*p}},mouseDownLeft:{minTimeElapsedInState:u,lookingDownLeft:{probability:p}},mouseDownRight:{minTimeElapsedInState:u,lookingDownRight:{probability:p}}}},bye:{transitions:{almostFinished:{wave:{}}}},wave:{transitions:{almostFinished:{idle:{}}}},thumbsUp:{transitions:{almostFinished:{idle:{}}}},knockKnock:{transitions:{almostFinished:{idle:{}}}},thinking:{transitions:{almostFinished:{idle:{}}}},lookingAround:{transitions:{almostFinished:{idle:{}}}},lookingAround2:{transitions:{almostFinished:{idle:{}}}},lookingUp:{transitions:{almostFinished:{idle:{}}}},lookingUpLeft:{transitions:{almostFinished:{idle:{}}}},lookingUpRight:{transitions:{almostFinished:{idle:{}}}},lookingLeft:{transitions:{almostFinished:{idle:{}}}},lookingRight:{transitions:{almostFinished:{idle:{}}}},lookingDown:{transitions:{almostFinished:{idle:{}}}},lookingDownLeft:{transitions:{almostFinished:{idle:{}}}},lookingDownRight:{transitions:{almostFinished:{idle:{}}}}},m=function(){function t(e){Object(r.a)(this,t),this._setState(e)}return Object(d.a)(t,[{key:"getState",value:function(){return this._state}},{key:"getNewState",value:function(t){return this._updateState(t),this._state}},{key:"_updateState",value:function(t){var e=c[this._state.name];if("failed"===t)return this._setState("idle"),void(this._stateStartTime=0);var i=e.transitions[t];if(i){if(i.minTimeElapsedInState)if((new Date).getTime()-this._stateStartTime<1e3*i.minTimeElapsedInState)return;for(var n=Math.random(),o=0,a=0,s=Object.entries(i);a<s.length;a++){var r=s[a],d=r[0];if(d in c&&!((o+=r[1].probability||1)<n))return void this._setState(d)}}}},{key:"_setState",value:function(t){this._state={name:t,info:c[t]},this._stateStartTime=(new Date).getTime()}}]),t}(),v=function(t){Object(l.a)(i,t);var e=Object(h.a)(i);function i(t){var n;return Object(r.a)(this,i),(n=e.call(this,t)).onVideoLoaded=function(t){n.videoRef.current.currentTime=n.getVideoStartTime(),n.props.onVideoLoaded&&n.props.onVideoLoaded(t)},n.onVideoError=function(t){n.hasError=!0},n.hasError=!1,n.videoRef=o.a.createRef(),n}return Object(d.a)(i,[{key:"isVideoReady",value:function(){return this.videoRef.current&&4===this.videoRef.current.readyState}},{key:"playFromBeginning",value:function(){this.isVideoReady()&&(this.videoRef.current.currentTime=this.getVideoStartTime())}},{key:"isAlmostFinished",value:function(){return!!this.isVideoReady()&&this.videoRef.current.duration-this.videoRef.current.currentTime<.1}},{key:"hasFailedToLoad",value:function(){return this.hasError}},{key:"getVideoStartTime",value:function(){var t;return"idle"===this.props.name&&(null===(t=this.videoRef.current)||void 0===t?void 0:t.duration)?Math.random()*this.videoRef.current.duration:0}},{key:"render",value:function(){return o.a.createElement("div",{style:{position:"absolute",top:0,left:0,width:this.props.width,height:this.props.height,borderRadius:this.props.width/2,WebkitMaskImage:"-webkit-radial-gradient(circle, white 100%, black 100%)"}},o.a.createElement("video",{ref:this.videoRef,autoPlay:!0,muted:!0,loop:!0,playsInline:!0,onError:this.onVideoError,onLoadedData:this.onVideoLoaded,width:this.props.width,height:this.props.height,style:{opacity:this.props.opacity}},o.a.createElement("source",{src:this.props.mediaPath+"/"+this.props.name+".mov"})))}}]),i}(o.a.Component),f=function(t){Object(l.a)(i,t);var e=Object(h.a)(i);function i(t){var n;return Object(r.a)(this,i),(n=e.call(this,t)).updateTransition=function(){if(!(n.state.transitionFraction>=1)&&n.snippetRef.current&&n.snippetRef.current.isVideoReady()){n.transitionStartTime||(n.transitionStartTime=(new Date).getTime(),"idle"===n.props.name&&"idle"===n.props.newName||n.snippetRef.current.playFromBeginning());var t=(new Date).getTime()-n.transitionStartTime,e=Math.min(t/400,1);n.setState({transitionFraction:e})}},n.onVideoLoaded=function(){n.props.onVideoLoaded()},n.transitionStartTime=null,n.state={transitionFraction:1},n.snippetRef=o.a.createRef(),n}return Object(d.a)(i,[{key:"isAlmostFinished",value:function(){var t,e;return null!==(t=null===(e=this.snippetRef.current)||void 0===e?void 0:e.isAlmostFinished())&&void 0!==t&&t}},{key:"hasFailedToLoad",value:function(){var t,e;return null!==(t=null===(e=this.snippetRef.current)||void 0===e?void 0:e.hasFailedToLoad())&&void 0!==t&&t}},{key:"shouldComponentUpdate",value:function(t,e){return t.newName===this.props.newName||(e.transitionFraction=0,this.transitionStartTime=null),!0}},{key:"componentDidMount",value:function(){this._timer=window.setInterval(this.updateTransition,30)}},{key:"componentWillUnmount",value:function(){window.clearInterval(this._timer)}},{key:"render",value:function(){return this.props.newName&&this.props.newName!==this.props.name?o.a.createElement("div",null,o.a.createElement(v,{key:this.props.name,mediaPath:this.props.mediaPath,width:this.props.width,height:this.props.height,name:this.props.name,opacity:1}),o.a.createElement(v,{ref:this.snippetRef,key:this.props.newName,mediaPath:this.props.mediaPath,opacity:this.state.transitionFraction,width:this.props.width,height:this.props.height,name:this.props.newName,onVideoLoaded:this.onVideoLoaded})):o.a.createElement("div",null,o.a.createElement(v,{ref:this.snippetRef,key:this.props.name,mediaPath:this.props.mediaPath,width:this.props.width,height:this.props.height,name:this.props.name,onVideoLoaded:this.onVideoLoaded,opacity:1}))}}]),i}(o.a.Component),g=function(t){Object(l.a)(i,t);var e=Object(h.a)(i);function i(t){var n;return Object(r.a)(this,i),(n=e.call(this,t)).tick50Ms=function(){var t,e;n.invokeEvent("tick50Ms"),(null===(t=n.snippetRef.current)||void 0===t?void 0:t.hasFailedToLoad())&&n.invokeEvent("failed"),(null===(e=n.snippetRef.current)||void 0===e?void 0:e.isAlmostFinished())&&n.invokeEvent("almostFinished")},n.onMouseMove=function(t){if(n.rootRef.current){var e=(new Date).getTime();if(!(e-n.lastMouseEvent<50)){n.lastMouseEvent=e;var i,o,a,s=n.rootRef.current.getBoundingClientRect(),r=s.x+Math.round(s.width/2),d=s.y+Math.round(s.height/2),l=t.clientX-r,h=t.clientY-d;if(!(Math.sqrt(Math.pow(l,2)+Math.pow(h,2))<.75*s.width))l>0?(i=Math.atan(-1*h/l)*(180/Math.PI),o="Right"):(i=Math.atan(h/l)*(180/Math.PI),o="Left"),a=i>67.5?"Up":i>22.5?"Up"+o:i>-22.5?o:i>-67.5?"Down"+o:"Down",n.invokeEvent("mouse"+a)}}},n.onAttention=function(){n.invokeEvent("attention")},n.onVideoLoaded=function(){n.onLoadedCalled||(n.onLoadedCalled=!0),n.props.onLoaded&&n.props.onLoaded()},n.stateMachine=new m(i.defaultSnippet),n.rootRef=o.a.createRef(),n.lastMouseEvent=(new Date).getTime(),n.snippetRef=o.a.createRef(),n.onLoadedCalled=!1,n.state={stateMachine:n.stateMachine,oldState:n.stateMachine.getState(),newState:n.stateMachine.getState()},n}return Object(d.a)(i,[{key:"componentDidMount",value:function(){this._timer=window.setInterval(this.tick50Ms,100),window.addEventListener("mousemove",this.onMouseMove)}},{key:"componentWillUnmount",value:function(){window.clearInterval(this._timer)}},{key:"invokeEvent",value:function(t){var e=this.stateMachine.getNewState(t);if(e.name!==this.state.newState.name){this.props.onSnippetChanged&&this.props.onSnippetChanged(e.name);var i="failed"===t?e:this.state.newState;this.setState({oldState:i,newState:e})}}},{key:"render",value:function(){return o.a.createElement("div",{ref:this.rootRef,onMouseEnter:this.onAttention,onClick:this.onAttention,style:{position:"relative",width:this.props.width,height:this.props.height}},o.a.createElement(f,{ref:this.snippetRef,mediaPath:this.props.snippetsMediaPath,width:this.props.width,height:this.props.height,name:this.state.oldState.name,newName:this.state.newState.name,onVideoLoaded:this.onVideoLoaded}))}}]),i}(o.a.Component);g.defaultSnippet="idle";i(13);var w=function(t){Object(l.a)(i,t);var e=Object(h.a)(i);function i(t){var n;return Object(r.a)(this,i),(n=e.call(this,t)).onPortraitChanged=function(t){n.setState({snippetName:t})},n.state={snippetName:g.defaultSnippet},n}return Object(d.a)(i,[{key:"render",value:function(){var t,e=new URL(document.location).searchParams,i=null!==(t=e.get("name"))&&void 0!==t?t:"shuw",n=null!==e.get("hideStateInfo");return o.a.createElement("div",{className:"App"},o.a.createElement("header",{className:"App-header"},o.a.createElement(g,{snippetsMediaPath:"/reactive-portrait/media/"+i,onSnippetChanged:this.onPortraitChanged,width:400,height:400}),n?null:o.a.createElement("div",{style:{paddingTop:"20px"}},this.state.snippetName)))}}]),i}(o.a.Component);Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));s.a.render(o.a.createElement(o.a.StrictMode,null,o.a.createElement(w,null)),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(t){t.unregister()})).catch((function(t){console.error(t.message)}))},7:function(t,e,i){t.exports=i(14)}},[[7,1,2]]]);
//# sourceMappingURL=main.70e5caed.chunk.js.map
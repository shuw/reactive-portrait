(this["webpackJsonpreactive-portrait"]=this["webpackJsonpreactive-portrait"]||[]).push([[0],{13:function(e,t,i){},14:function(e,t,i){},15:function(e,t,i){"use strict";i.r(t);var n=i(0),o=i.n(n),a=i(6),s=i.n(a),r=(i(13),i(1)),l=i(2),h=i(4),d=i(3),p=i(7),u=function(){function e(){Object(r.a)(this,e)}return Object(l.a)(e,null,[{key:"get",value:function(e){var t,i;return e.lookAround?(t=1,i=1):(t=.02,i=5),{idle:{events:{tick50Ms:{minTimeElapsedInState:10,wave:{probability:.001},smile:{probability:5e-4},lookingAround:{probability:3e-4},lookingAround2:{probability:2e-4}},attention:{wave:{probability:.2},thumbsUp:{probability:.2},smile:{probability:.2},thinking:{probability:.2},customReaction1:{probability:.2},customReaction2:{probability:.2},customReaction3:{probability:.2},customReaction4:{probability:.2},customReaction5:{probability:.2}},thumbsUp:{thumbsUp:{}},bye:{bye:{}},lookLeft:{lookingLeft:{}},lookRight:{lookingRight:{}},lookDown:{lookingDown:{}},lookUp:{lookingUp:{}},mouseUp:{minTimeElapsedInState:i,lookingUp:{probability:t}},mouseUpLeft:{minTimeElapsedInState:i,lookingUpLeft:{probability:t}},mouseUpRight:{minTimeElapsedInState:i,lookingUpRight:{probability:t}},mouseLeft:{minTimeElapsedInState:i,lookingLeft:{probability:t}},mouseRight:{minTimeElapsedInState:i,lookingRight:{probability:t}},mouseDown:{minTimeElapsedInState:i,lookingDown:{probability:.5*t}},mouseDownLeft:{minTimeElapsedInState:i,lookingDownLeft:{probability:t}},mouseDownRight:{minTimeElapsedInState:i,lookingDownRight:{probability:t}}}},bye:{events:{almostFinished:{wave:{}}}},smile:{events:{almostFinished:{idle:{}}}},wave:{events:{almostFinished:{idle:{}}}},thumbsUp:{events:{almostFinished:{idle:{}}}},knockKnock:{events:{almostFinished:{idle:{}}}},thinking:{events:{almostFinished:{idle:{}}}},lookingAround:{events:{almostFinished:{idle:{}}}},lookingAround2:{events:{almostFinished:{idle:{}}}},lookingUp:{events:{almostFinished:{idle:{}}}},lookingUpLeft:{events:{almostFinished:{idle:{}}}},lookingUpRight:{events:{almostFinished:{idle:{}}}},lookingLeft:{events:{almostFinished:{idle:{}}}},lookingRight:{events:{almostFinished:{idle:{}}}},lookingDown:{events:{almostFinished:{idle:{}}}},lookingDownLeft:{events:{almostFinished:{idle:{}}}},lookingDownRight:{events:{almostFinished:{idle:{}}}},customReaction1:{events:{almostFinished:{idle:{}}}},customReaction2:{events:{almostFinished:{idle:{}}}},customReaction3:{events:{almostFinished:{idle:{}}}},customReaction4:{events:{almostFinished:{idle:{}}}},customReaction5:{events:{almostFinished:{idle:{}}}}}}}]),e}(),c=function(){function e(t){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};Object(r.a)(this,e),this.states=u.get(i),this._setState(t,null),this.previousState=this.state,this.statesWithoutFiles={}}return Object(l.a)(e,[{key:"getState",value:function(){return this.state}},{key:"getNewState",value:function(e){return this._updateState(e),this.state}},{key:"_updateState",value:function(e){if("fileNotFound"===e)return this.statesWithoutFiles[this.state.name]=!0,void(this.state=this.previousState);var t=this.state.info.events[e];if(t){if(t.minTimeElapsedInState)if((new Date).getTime()-this.state.startTime<1e3*t.minTimeElapsedInState)return;var i,n=Math.random(),o=0,a=Object.entries(t).sort((function(){return.5-Math.random()})),s=Object(p.a)(a);try{for(s.s();!(i=s.n()).done;){var r=i.value,l=r[0],h=r[1];if(h.constructor===Object&&!(l in this.statesWithoutFiles))if(l in this.states){if(!((o+=h.probability||1)<n))return void this._setState(l,e)}else console.error("ERROR, state not found: "+l)}}catch(d){s.e(d)}finally{s.f()}}}},{key:"_setState",value:function(e,t){this.previousState=this.state,this.state={name:e,info:this.states[e],triggeringEvent:t,startTime:(new Date).getTime()}}}]),e}(),m=function(e){Object(h.a)(i,e);var t=Object(d.a)(i);function i(e){var n;return Object(r.a)(this,i),(n=t.call(this,e)).onVideoLoaded=function(e){n.videoRef.current.currentTime=n.getVideoStartTime(),n.props.onVideoLoaded&&n.props.onVideoLoaded(e)},n.onVideoError=function(e){n.hasError=!0},n.hasError=!1,n.videoRef=o.a.createRef(),n}return Object(l.a)(i,[{key:"isVideoReady",value:function(){return this.videoRef.current&&this.videoRef.current.readyState>0}},{key:"playFromBeginning",value:function(){this.isVideoReady()&&(this.videoRef.current.currentTime=this.getVideoStartTime())}},{key:"isAlmostFinished",value:function(){return!!this.isVideoReady()&&this.videoRef.current.duration-this.videoRef.current.currentTime<.1}},{key:"hasFailedToLoad",value:function(){return this.hasError}},{key:"getVideoStartTime",value:function(){var e;return"idle"===this.props.name&&(null===(e=this.videoRef.current)||void 0===e?void 0:e.duration)?Math.random()*this.videoRef.current.duration:0}},{key:"render",value:function(){return o.a.createElement("div",{style:{position:"absolute",top:0,left:0,width:this.props.width,height:this.props.height,borderRadius:this.props.width/2,WebkitMaskImage:"-webkit-radial-gradient(circle, white 100%, black 100%)"}},o.a.createElement("video",{ref:this.videoRef,autoPlay:!0,muted:!0,loop:!0,playsInline:!0,onError:this.onVideoError,onLoadedData:this.onVideoLoaded,width:this.props.width,height:this.props.height,style:{opacity:this.props.opacity}},o.a.createElement("source",{src:this.props.mediaPath+"/"+this.props.name+".mov"})))}}]),i}(o.a.Component),v=function(e){Object(h.a)(i,e);var t=Object(d.a)(i);function i(e){var n;return Object(r.a)(this,i),(n=t.call(this,e)).updateTransition=function(){if(!(n.state.transitionFraction>=1)&&n.snippetRef.current&&n.snippetRef.current.isVideoReady()){n.transitionStartTime||(n.transitionStartTime=(new Date).getTime(),"idle"===n.props.name&&"idle"===n.props.newName||n.snippetRef.current.playFromBeginning());var e=(new Date).getTime()-n.transitionStartTime,t=Math.min(e/400,1);n.setState({transitionFraction:t})}},n.onVideoLoaded=function(){n.props.onVideoLoaded()},n.transitionStartTime=null,n.state={transitionFraction:1},n.snippetRef=o.a.createRef(),n}return Object(l.a)(i,[{key:"isAlmostFinished",value:function(){var e,t;return null!==(e=null===(t=this.snippetRef.current)||void 0===t?void 0:t.isAlmostFinished())&&void 0!==e&&e}},{key:"hasFailedToLoad",value:function(){var e,t;return null!==(e=null===(t=this.snippetRef.current)||void 0===t?void 0:t.hasFailedToLoad())&&void 0!==e&&e}},{key:"shouldComponentUpdate",value:function(e,t){return e.newName===this.props.newName||(t.transitionFraction=0,this.transitionStartTime=null),!0}},{key:"componentDidMount",value:function(){this._timer=window.setInterval(this.updateTransition,30)}},{key:"componentWillUnmount",value:function(){window.clearInterval(this._timer)}},{key:"render",value:function(){return this.props.newName&&this.props.newName!==this.props.name?o.a.createElement("div",null,o.a.createElement(m,{key:this.props.name,mediaPath:this.props.mediaPath,width:this.props.width,height:this.props.height,name:this.props.name,opacity:1}),o.a.createElement(m,{ref:this.snippetRef,key:this.props.newName,mediaPath:this.props.mediaPath,opacity:this.state.transitionFraction,width:this.props.width,height:this.props.height,name:this.props.newName,onVideoLoaded:this.onVideoLoaded})):o.a.createElement("div",null,o.a.createElement(m,{ref:this.snippetRef,key:this.props.name,mediaPath:this.props.mediaPath,width:this.props.width,height:this.props.height,name:this.props.name,onVideoLoaded:this.onVideoLoaded,opacity:1}))}}]),i}(o.a.Component),g=function(e){Object(h.a)(i,e);var t=Object(d.a)(i);function i(e){var n,a;return Object(r.a)(this,i),(a=t.call(this,e)).tick50Ms=function(){var e,t;a.invokeEvent("tick50Ms"),(null===(e=a.snippetRef.current)||void 0===e?void 0:e.hasFailedToLoad())&&a.invokeEvent("fileNotFound"),(null===(t=a.snippetRef.current)||void 0===t?void 0:t.isAlmostFinished())&&a.invokeEvent("almostFinished")},a.onMouseMove=function(e){if(a.rootRef.current){var t=(new Date).getTime();if(!(t-a.lastMouseEvent<50)){a.lastMouseEvent=t;var i,n,o,s=a.rootRef.current.getBoundingClientRect(),r=s.x+Math.round(s.width/2),l=s.y+Math.round(s.height/2),h=e.clientX-r,d=e.clientY-l;if(!(Math.sqrt(Math.pow(h,2)+Math.pow(d,2))<.75*s.width))h>0?(i=Math.atan(-1*d/h)*(180/Math.PI),n="Right"):(i=Math.atan(d/h)*(180/Math.PI),n="Left"),o=i>67.5?"Up":i>22.5?"Up"+n:i>-22.5?n:i>-67.5?"Down"+n:"Down",a.invokeEvent("mouse"+o)}}},a.onAttention=function(){a.invokeEvent("attention")},a.onVideoLoaded=function(){a.onLoadedCalled||(a.onLoadedCalled=!0),a.props.onLoaded&&a.props.onLoaded()},a.stateMachine=new c(i.defaultSnippet,null!==(n=e.options)&&void 0!==n?n:{}),a.rootRef=o.a.createRef(),a.lastMouseEvent=(new Date).getTime(),a.snippetRef=o.a.createRef(),a.onLoadedCalled=!1,a.state={stateMachine:a.stateMachine,oldState:a.stateMachine.getState(),newState:a.stateMachine.getState()},a}return Object(l.a)(i,[{key:"componentDidMount",value:function(){this._timer=window.setInterval(this.tick50Ms,100),window.addEventListener("mousemove",this.onMouseMove)}},{key:"componentWillUnmount",value:function(){window.clearInterval(this._timer)}},{key:"logVerbose",value:function(e){this.props.options.verboseLogging&&console.log(e)}},{key:"invokeEvent",value:function(e){this.props.options.verboseLogging&&"tick50Ms"!==e&&this.logVerbose("event: "+e);var t,i=this.stateMachine.state.triggeringEvent,n=this.stateMachine.getNewState(e);n.name!==this.state.newState.name&&("fileNotFound"===e?(t=n,null!==i&&(this.logVerbose("Re-triggering event because file not found: "+i),n=this.stateMachine.getNewState(i))):t=this.state.newState,this.props.onSnippetChanged&&this.props.onSnippetChanged(n.name),this.setState({oldState:t,newState:n}))}},{key:"render",value:function(){return o.a.createElement("div",{ref:this.rootRef,onMouseEnter:this.onAttention,onClick:this.onAttention,style:{position:"relative",width:this.props.width,height:this.props.height}},o.a.createElement(v,{ref:this.snippetRef,mediaPath:this.props.snippetsMediaPath,width:this.props.width,height:this.props.height,name:this.state.oldState.name,newName:this.state.newState.name,onVideoLoaded:this.onVideoLoaded}))}}]),i}(o.a.Component);g.defaultSnippet="idle";i(14);var f=function(e){Object(h.a)(i,e);var t=Object(d.a)(i);function i(e){var n;return Object(r.a)(this,i),(n=t.call(this,e)).onPortraitChanged=function(e){n.setState({snippetName:e})},n.state={snippetName:g.defaultSnippet},n}return Object(l.a)(i,[{key:"render",value:function(){var e,t,i=this,n=new URL(document.location).searchParams,a=(null!==(e=null!==(t=n.get("names"))&&void 0!==t?t:n.get("name"))&&void 0!==e?e:"shuw").split(","),s=null!==n.get("debug")?"http://localhost:3001/":"https://shuw.github.io/reactive-portrait-media/",r=a.map((function(e){return o.a.createElement("div",{key:e,style:{display:"inline-block",width:"400px",padding:"20px",textAlign:"center"}},o.a.createElement(g,{options:{lookAround:null!==n.get("lookAround"),verboseLogging:null!==n.get("verboseLogging")},snippetsMediaPath:s+e,onSnippetChanged:i.onPortraitChanged,width:400,height:400}))})),l=null!==n.get("hideStateInfo")||1!==r.length;return o.a.createElement("div",{className:"App"},o.a.createElement("a",{style:{position:"absolute",top:"20px",right:"20px",color:"#aaa"},href:"https://github.com/shuw/reactive-portrait",target:"_blnk"},"Source Code"),o.a.createElement("div",{style:{paddingTop:"150px"}},r),l?null:o.a.createElement("div",{style:{color:"#aaa",paddingTop:"10px",fontSize:"20px"}},this.state.snippetName))}}]),i}(o.a.Component);Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));s.a.render(o.a.createElement(o.a.StrictMode,null,o.a.createElement(f,null)),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()})).catch((function(e){console.error(e.message)}))},8:function(e,t,i){e.exports=i(15)}},[[8,1,2]]]);
//# sourceMappingURL=main.6d81aa6e.chunk.js.map